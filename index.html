<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rigid Heddle Weaving Pattern Visualizer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>ðŸ§µ Rigid Heddle Pattern Visualizer</h1>
                <p class="subtitle">Design, Edit & Preview Your Weaving Projects</p>
            </div>
            <div class="header-actions">
                <button onclick="loadPattern()">Load</button>
                <button onclick="savePattern()">Save</button>
                <button onclick="exportJSON()">Export</button>
            </div>
        </header>

        <div class="content">
            <aside class="sidebar">
                <!-- Tab Navigation -->
                <div class="tabs">
                    <button class="tab-button active" onclick="switchTab(event, 'overview')">Overview</button>
                    <button class="tab-button" onclick="switchTab(event, 'setup')">Setup</button>
                    <button class="tab-button" onclick="switchTab(event, 'colors')">Colors</button>
                    <button class="tab-button" onclick="switchTab(event, 'edit')">Edit</button>
                </div>

                <!-- Tab 1: Overview -->
                <div class="tab-content" id="tab-overview">
                    <div class="form-group">
                        <label class="form-label">Pattern Name</label>
                        <input type="text" id="patternName" class="form-input-inline" value="Navy & White Scarf"
                               onchange="updatePatternName(this.value)" style="width: 100%;">
                    </div>

                    <div class="section">
                        <h3>Quick Facts</h3>
                        <div class="pattern-info">
                            <div class="info-row">
                                <span class="info-label">Fabric Size:</span>
                                <span class="info-value" id="infoSize">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Loom:</span>
                                <span class="info-value" id="infoLoom">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Warp Threads:</span>
                                <span class="info-value" id="infoEnds">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Weft Rows:</span>
                                <span class="info-value" id="infoRows">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Validation</h3>
                        <div class="validation-results" id="validationResults">
                            <p>Make changes to see validation results.</p>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Color Legend</h3>
                        <div class="legend" id="colorLegend"></div>
                    </div>
                </div>

                <!-- Tab 2: Setup -->
                <div class="tab-content hidden" id="tab-setup">
                    <div class="section">
                        <h3>My Loom</h3>
                        <div class="form-group">
                            <label class="form-label">Loom Width (inches)</label>
                            <select id="loomWidth" class="form-select" onchange="updateLoomWidth(this.value)">
                                <option value="10">10"</option>
                                <option value="15">15"</option>
                                <option value="16" selected>16"</option>
                                <option value="20">20"</option>
                                <option value="24">24"</option>
                                <option value="32">32"</option>
                                <option value="40">40"</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Heddle Dent (threads per inch)</label>
                            <select id="heddleDent" class="form-select" onchange="updateHeddleDent(this.value)">
                                <option value="5">5 dent</option>
                                <option value="7.5">7.5 dent</option>
                                <option value="8" selected>8 dent</option>
                                <option value="10">10 dent</option>
                                <option value="12">12 dent</option>
                                <option value="12.5">12.5 dent</option>
                                <option value="15">15 dent</option>
                            </select>
                            <div class="helper-text">This determines how many warp threads per inch (EPI)</div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Project Design</h3>
                        <div class="form-group">
                            <label class="form-label">Fabric Width (inches)</label>
                            <input type="number" id="fabricWidth" class="form-input" value="12" min="1" max="40" step="0.5"
                                   onchange="updateFabricWidth(this.value)">
                            <div id="widthFeedback" class="helper-text"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Fabric Length (inches)</label>
                            <input type="number" id="fabricLength" class="form-input" value="70" min="6" step="1"
                                   onchange="updateFabricLength(this.value)">
                        </div>

                        <div class="pattern-info">
                            <div class="info-row">
                                <span class="info-label">Calculated Warp Threads:</span>
                                <span class="info-value" id="calcWarpEnds">96</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">At EPI:</span>
                                <span class="info-value" id="calcEPI">8</span>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h3>Finishing</h3>
                        <div class="form-group">
                            <label class="form-label">Method</label>
                            <select id="finishingMethod" class="form-select" onchange="updateFinishingMethod(this.value)">
                                <option value="hemstitch" selected>Hemstitch</option>
                                <option value="twisted_fringe">Twisted Fringe</option>
                                <option value="sewn_hem">Sewn Hem</option>
                                <option value="knotted_fringe">Knotted Fringe</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Fringe Length (inches)</label>
                            <input type="number" id="fringeLength" class="form-input" value="4" min="0" max="12" step="0.5"
                                   onchange="updateFringeLength(this.value)">
                        </div>
                    </div>
                </div>

                <!-- Tab 3: Colors -->
                <div class="tab-content hidden" id="tab-colors">
                    <div class="section">
                        <h3>Warp Colors</h3>

                        <div class="pattern-type-group">
                            <label class="pattern-type-option">
                                <input type="radio" name="warpPattern" value="alternating" checked onchange="updateWarpPatternType(this.value)">
                                Alternating
                            </label>
                            <label class="pattern-type-option">
                                <input type="radio" name="warpPattern" value="solid" onchange="updateWarpPatternType(this.value)">
                                Solid
                            </label>
                        </div>

                        <div id="warpColorControls">
                            <div class="color-picker-group">
                                <input type="color" id="warpColor0" value="#001f3f" onchange="updateWarpColor(0, this.value)">
                                <input type="text" id="warpColorName0" class="form-input" value="Navy" placeholder="Color name"
                                       onchange="updateWarpColorName(0, this.value)">
                                <input type="number" id="warpThreads0" class="form-input" value="1" min="1" max="10"
                                       onchange="updateWarpThreads(0, this.value)">
                                <span style="font-size: 0.85em; color: #6c757d;">thread(s)</span>
                            </div>

                            <div class="color-picker-group">
                                <input type="color" id="warpColor1" value="#f5f5f5" onchange="updateWarpColor(1, this.value)">
                                <input type="text" id="warpColorName1" class="form-input" value="White" placeholder="Color name"
                                       onchange="updateWarpColorName(1, this.value)">
                                <input type="number" id="warpThreads1" class="form-input" value="1" min="1" max="10"
                                       onchange="updateWarpThreads(1, this.value)">
                                <span style="font-size: 0.85em; color: #6c757d;">thread(s)</span>
                            </div>
                        </div>

                        <div class="warp-preview" id="warpPreview"></div>
                        <div class="helper-text" id="warpPreviewText">96 threads total</div>
                    </div>

                    <div class="section">
                        <h3>Weft Colors</h3>

                        <div class="form-group">
                            <label class="form-label">Primary Weft Color</label>
                            <div class="color-picker-group">
                                <input type="color" id="weftColor" value="#7f8c8d" onchange="updateWeftColor(this.value)">
                                <input type="text" id="weftColorName" class="form-input" value="Grey" placeholder="Color name"
                                       onchange="updateWeftColorName(this.value)">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Yarn Weight</label>
                            <select id="yarnWeight" class="form-select" onchange="updateYarnWeight(this.value)">
                                <option value="lace">Lace</option>
                                <option value="fingering">Fingering</option>
                                <option value="sport">Sport</option>
                                <option value="dk">DK</option>
                                <option value="worsted" selected>Worsted</option>
                                <option value="aran">Aran</option>
                                <option value="bulky">Bulky</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Rows per Inch (PPI)</label>
                            <input type="number" id="ppi" class="form-input" value="10" min="4" max="20" step="1"
                                   onchange="updatePPI(this.value)">
                            <div class="helper-text">Typically 8-12 for most yarns</div>
                        </div>
                    </div>
                </div>

                <!-- Tab 4: Edit -->
                <div class="tab-content hidden" id="tab-edit">
                    <div class="section">
                        <h3>Weaving Sections</h3>
                        <div id="sectionsList"></div>

                        <button class="add-section-btn" onclick="addSection()">
                            <span>+</span>
                            <span>Add Section</span>
                        </button>

                        <div class="total-length">
                            Total: <strong id="totalLength">70</strong> inches
                        </div>
                    </div>
                </div>
            </aside>

            <main class="main">
                <div class="canvas-container">
                    <canvas id="weavingCanvas" width="800" height="600"></canvas>
                    <div style="font-size: 0.85em; color: #6c757d; text-align: center; margin-top: -10px;">
                        ðŸ’¡ Drag to pan â€¢ Scroll to zoom â€¢ Click buttons below for quick actions
                    </div>

                    <div class="controls">
                        <button onclick="validatePattern()">Validate Pattern</button>
                        <button onclick="renderPattern()">Render Pattern</button>

                        <div class="zoom-control">
                            <button onclick="zoom(0.8)">-</button>
                            <span id="zoomLevel">100%</span>
                            <button onclick="zoom(1.25)">+</button>
                        </div>

                        <button onclick="fitToView()">Fit to View</button>
                        <button onclick="resetView()">Reset View</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <!-- JavaScript Modules -->
    <script src="js/validator.js"></script>
    <script src="js/renderer.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
